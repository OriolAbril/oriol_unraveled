
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.19: https://docutils.sourceforge.io/" name="generator"/>
<meta content="PyMC 4.0 with labeled coords and dims" property="og:title"/>
<meta content="website" property="og:type"/>
<meta content="https://oriolabrilpla.cat/blog/posts/2022/pymc-arviz.html" property="og:url"/>
<meta content="Oriol unraveled" property="og:site_name"/>
<meta content="For the of labeled arrays: While PyMC 3.9.0 came with some amazing news for those of us who love labeled arrays: support for using coordinate and dimension names to specify the shapes of variables ..." property="og:description"/>
<meta content="https://oriolabrilpla.cat/_images/labeled_arys_v4.png" property="og:image"/>
<meta content="" property="og:image:alt"/>
<meta content="For the of labeled arrays: While PyMC 3.9.0 came with some amazing news for those of us who love labeled arrays: support for using coordinate and dimension names to specify the shapes of variables ..." name="description"/>
<title>PyMC 4.0 with labeled coords and dims — Oriol unraveled</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
<!-- Loaded before other Sphinx assets -->
<link href="../../../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link href="../../../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../../_static/css/style.css" rel="stylesheet" type="text/css">
<link href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css">
<link href="../../../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../../../_static/sphinx-codeautolink.css" rel="stylesheet" type="text/css">
<link href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" rel="stylesheet" type="text/css">
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94" rel="preload"/>
<link as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94" rel="preload"/>
<script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
<script src="../../../_static/jquery.js"></script>
<script src="../../../_static/underscore.js"></script>
<script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../../../_static/doctools.js"></script>
<script src="../../../_static/sphinx_highlight.js"></script>
<script src="../../../_static/clipboard.min.js"></script>
<script src="../../../_static/copybutton.js"></script>
<script src="../../../_static/design-tabs.js"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'blog/posts/2022/pymc-arviz';</script>
<script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/OriolAbril/oriol_unraveled/sphinx/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'en';
        </script>
<link href="../../../_static/favicon.ico" rel="shortcut icon">
<link href="../../../about.html" rel="author" title="About these documents">
<link href="../../../genindex.html" rel="index" title="Index">
<link href="../../../search.html" rel="search" title="Search"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
</link></link></link></link></link></link></link></link></link></head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target="#bd-toc-nav" data-default-mode="light" data-offset="180">
<a class="skip-link" href="#main">Skip to main content</a>
<input class="sidebar-toggle" id="__primary" name="__primary" type="checkbox"/>
<label class="overlay overlay-primary" for="__primary"></label>
<input class="sidebar-toggle" id="__secondary" name="__secondary" type="checkbox"/>
<label class="overlay overlay-secondary" for="__secondary"></label>
<div class="search-button__wrapper">
<div class="search-button__overlay"></div>
<div class="search-button__search-container">
<form action="../../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" id="search-input" name="q" placeholder="Search..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
</div>
</div>
<header class="logo-header">
<a class="logo" href="../../../index.html">Oriol unraveled</a>
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<div class="bd-sidebar-primary bd-sidebar hide-on-wide">
<div class="sidebar-header-items sidebar-primary__section">
<div class="sidebar-header-items__center">
<div class="navbar-center-item">
<nav class="navbar-nav">
<p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
        Site Navigation
    </p>
<ul class="navbar-nav" id="navbar-main-elements">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects.html">
                        Projects
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../about.html">
                        About me
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../blog.html">
                        Blog
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../tag.html">
                        Tags
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../category.html">
                        Categories
                      </a>
</li>
</ul>
</nav>
</div>
</div>
<div class="sidebar-header-items__end">
<div class="navbar-end-item">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://github.com/OriolAbril" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-github"></i></span>
<label class="sr-only">GitHub</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://twitter.com/OriolAbril" rel="noopener" target="_blank" title="Twitter"><span><i class="fa-brands fa-twitter"></i></span>
<label class="sr-only">Twitter</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://toot.cat/@oriolabril" rel="me" target="_blank" title="Mastodon"><span><i class="fa-brands fa-mastodon"></i></span>
<label class="sr-only">Mastodon</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://oriolabrilpla.cat/en/blog/atom.xml" rel="noopener" target="_blank" title="Atom Feed"><span><i class="fa-solid fa-rss"></i></span>
<label class="sr-only">Atom Feed</label></a>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebar-end-items sidebar-primary__section">
<div class="sidebar-end-items__item">
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content">
<div class="bd-content-nav bd-content">
<div class="bd-header-article">
<nav class="navbar navbar-expand-lg" id="navbar-main">
<label class="sidebar-toggle primary-toggle" for="__primary">
<span class="fa-solid fa-bars"></span>
</label>
<div class="article-navbar-text-links">
<nav class="navbar-nav">
<p aria-label="Site Navigation" aria-level="1" class="sidebar-header-items__title" role="heading">
        Site Navigation
    </p>
<ul class="navbar-nav" id="navbar-main-elements">
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../projects.html">
                        Projects
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../about.html">
                        About me
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../../blog.html">
                        Blog
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../tag.html">
                        Tags
                      </a>
</li>
<li class="nav-item">
<a class="nav-link nav-internal" href="../../category.html">
                        Categories
                      </a>
</li>
</ul>
</nav>
</div>
<div class="article-navbar-version-switcher">
<div class="version-switcher__container dropdown">
<button class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-toggle="dropdown" type="button">
        en  <!-- this text may get changed later by javascript -->
<span class="caret"></span>
</button>
<div class="version-switcher__menu dropdown-menu list-group-flush py-0">
<!-- dropdown will be populated by javascript on page load -->
</div>
</div>
</div>
<div class="article-navbar-search">
<button aria-label="Search" class="btn btn-sm navbar-btn search-button search-button__button" data-toggle="tooltip" title="Search">
<i class="fa-solid fa-magnifying-glass"></i>
</button>
</div>
<div class="article-navbar-icon-links">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://github.com/OriolAbril" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-github"></i></span>
<label class="sr-only">GitHub</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://twitter.com/OriolAbril" rel="noopener" target="_blank" title="Twitter"><span><i class="fa-brands fa-twitter"></i></span>
<label class="sr-only">Twitter</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://toot.cat/@oriolabril" rel="me" target="_blank" title="Mastodon"><span><i class="fa-brands fa-mastodon"></i></span>
<label class="sr-only">Mastodon</label></a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tooltip" href="https://oriolabrilpla.cat/en/blog/atom.xml" rel="noopener" target="_blank" title="Atom Feed"><span><i class="fa-solid fa-rss"></i></span>
<label class="sr-only">Atom Feed</label></a>
</li>
</ul>
</div>
<label class="sidebar-toggle secondary-toggle" for="__secondary">
<span class="fa-solid fa-outdent"></span>
</label>
</nav></div>
<div class="bd-content" id="main">
<div class="bd-article-container bd-content-page">
<article class="bd-article" role="main">
<section class="tex2jax_ignore mathjax_ignore" id="pymc-4-0-with-labeled-coords-and-dims">
<span id="pymc-arviz"></span><h1>PyMC 4.0 with labeled coords and dims<a class="headerlink" href="#pymc-4-0-with-labeled-coords-and-dims" title="Permalink to this heading">#</a></h1>
<img alt="" class="hidden-metadata" src="../../../_images/labeled_arys_v4.png"/>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import arviz as az
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import pymc as pm
import aesara.tensor as at

rng = np.random.default_rng()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>az.style.use("arviz-darkgrid")
</pre></div>
</div>
</div>
</div>
<section id="for-the-svg-version-1-1-width-1-0em-height-1-0em-class-sd-octicon-sd-octicon-heart-fill-sd-text-danger-viewbox-0-0-16-16-aria-hidden-true-path-fill-rule-evenodd-d-m7-655-14-916l8-14-25l-345-666a-752-752-0-01-69-0zm0-0l8-14-25l-345-666-002-001-006-003-018-01a7-643-7-643-0-00-31-17-22-08-22-08-0-003-433-2-414c13-956-10-731-16-8-35-16-5-5-16-2-836-13-914-1-11-75-1-10-203-1-8-847-1-802-8-3-02-7-153-1-802-5-797-1-4-25-1-2-086-1-0-2-836-0-5-5c0-2-85-2-045-5-231-3-885-6-818a22-075-22-075-0-003-744-2-584l-018-01-006-003h-002z-path-svg-of-labeled-arrays">
<h2>For the <svg aria-hidden="true" class="sd-octicon sd-octicon-heart-fill sd-text-danger" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M7.655 14.916L8 14.25l.345.666a.752.752 0 01-.69 0zm0 0L8 14.25l.345.666.002-.001.006-.003.018-.01a7.643 7.643 0 00.31-.17 22.08 22.08 0 003.433-2.414C13.956 10.731 16 8.35 16 5.5 16 2.836 13.914 1 11.75 1 10.203 1 8.847 1.802 8 3.02 7.153 1.802 5.797 1 4.25 1 2.086 1 0 2.836 0 5.5c0 2.85 2.045 5.231 3.885 6.818a22.075 22.075 0 003.744 2.584l.018.01.006.003h.002z" fill-rule="evenodd"></path></svg> of labeled arrays<a class="headerlink" href="#for-the-svg-version-1-1-width-1-0em-height-1-0em-class-sd-octicon-sd-octicon-heart-fill-sd-text-danger-viewbox-0-0-16-16-aria-hidden-true-path-fill-rule-evenodd-d-m7-655-14-916l8-14-25l-345-666a-752-752-0-01-69-0zm0-0l8-14-25l-345-666-002-001-006-003-018-01a7-643-7-643-0-00-31-17-22-08-22-08-0-003-433-2-414c13-956-10-731-16-8-35-16-5-5-16-2-836-13-914-1-11-75-1-10-203-1-8-847-1-802-8-3-02-7-153-1-802-5-797-1-4-25-1-2-086-1-0-2-836-0-5-5c0-2-85-2-045-5-231-3-885-6-818a22-075-22-075-0-003-744-2-584l-018-01-006-003h-002z-path-svg-of-labeled-arrays" title="Permalink to this heading">#</a></h2>
<p>While <a class="reference external" href="https://github.com/pymc-devs/pymc3/blob/master/RELEASE-NOTES.md#pymc3-390-16-june-2020">PyMC 3.9.0</a> came with some amazing news for those of us who love labeled arrays: support for using coordinate and dimension names to specify the shapes of variables in a <code class="docutils literal notranslate"><span class="pre">pm.Model</span></code>; now, 2 years later, with the release of PyMC 4.0, the integration between ArviZ and PyMC has improved even more.</p>
<p>Therefore, I decided to post and updated version of <a class="reference internal" href="../2020/pymc3-arviz.html#pymc3-arviz"><span class="std std-ref">my original blog post</span></a> using version 3.x of PyMC now using
version 4.0 of PyMC which was released earlier this week.</p>
<p>This post will focus on using PyMC coords, dims and dims without coordinate values, and explain the conversion of traces and models to <a class="reference external" href="https://python.arviz.org/en/latest/getting_started/XarrayforArviZ.html"><code class="docutils literal notranslate"><span class="pre">InferenceData</span></code></a>. Here are two resources to <a class="reference external" href="https://python.arviz.org/en/latest/getting_started/WorkingWithInferenceData.html">learn about working with <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code></a> on ArviZ docs and to see <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> in action in the famous <a class="reference external" href="https://www.pymc.io/projects/examples/en/latest/case_studies/multilevel_modeling.html">radon example</a> on PyMC examples website.</p>
<p>We will use an example based approach and use models from the <a class="reference external" href="https://www.pymc.io/projects/examples/en/latest">example gallery</a> to illustrate how to use coords and dims within PyMC models.</p>
</section>
<section id="st-example-rugby-analytics">
<h2>1st example: rugby analytics<a class="headerlink" href="#st-example-rugby-analytics" title="Permalink to this heading">#</a></h2>
<p>We will use an alternative parametrization of the same model used in the <a class="reference external" href="https://www.pymc.io/projects/examples/en/latest/case_studies/rugby_analytics.html">rugby analytics example</a> taking advantage of dims and coords. Here, we will use as observations a 2d matrix, whose rows are the matches and whose columns are the field: home and away.</p>
<p>The first step after preprocessing is to define the dimensions used by the model and their coordinates. In our case, we have 3 dimensions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">team</span></code>: each team will have its own offensive and defensive power</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">match</span></code>: an integer identifying the match. There are 6 teams who play twice against each other so we have <code class="docutils literal notranslate"><span class="pre">6*5*2=60</span></code> matches</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field</span></code>: either home or away.</p></li>
</ul>
<p>These coordinates are passed to <code class="docutils literal notranslate"><span class="pre">pm.Model</span></code> as a dict whose keys are dimension names and whose values are coordinate values. The dimensions can then be used when defining PyMC variables to indicate their shape.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df_rugby = pd.read_csv(pm.get_data('rugby.csv'), index_col=0)
home_idx, teams = pd.factorize(df_rugby["home_team"], sort=True)
away_idx, _ = pd.factorize(df_rugby["away_team"], sort=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coords = {
    "team": teams,
    "match": np.arange(60),
    "field": ["home", "away"],
}
with pm.Model(coords=coords) as rugby_model:
    # global model parameters
    home = pm.Flat('home')
    sd_att = pm.HalfStudentT('sd_att', nu=3, sigma=2.5)
    sd_def = pm.HalfStudentT('sd_def', nu=3, sigma=2.5)
    intercept = pm.Flat('intercept')

    # team-specific model parameters
    atts_star = pm.Normal("atts_star", mu=0, sigma=sd_att, dims="team")
    defs_star = pm.Normal("defs_star", mu=0, sigma=sd_def, dims="team")

    atts = pm.Deterministic('atts', atts_star - at.mean(atts_star), dims="team")
    defs = pm.Deterministic('defs', defs_star - at.mean(defs_star), dims="team")
    home_theta = at.exp(intercept + home + atts[home_idx] + defs[away_idx])
    away_theta = at.exp(intercept + atts[away_idx] + defs[home_idx])

    # likelihood of observed data
    pm.Poisson(
        'points', 
        mu=at.stack((home_theta, away_theta)).T, 
        observed=df_rugby[["home_score", "away_score"]],
        dims=("match", "field")
    )
    rugby_idata = pm.sample(1000, tune=1000, cores=4)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [home, sd_att, sd_def, intercept, atts_star, defs_star]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
<progress class="" max="8000" style="width:300px; height:20px; vertical-align: middle;" value="8000"></progress>
      100.00% [8000/8000 00:19&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 20 seconds.
</pre></div>
</div>
</div>
</div>
<p>We have now <em>defined</em> the shapes of some of our variables (<code class="docutils literal notranslate"><span class="pre">atts_star</span></code> and <code class="docutils literal notranslate"><span class="pre">defs_star</span></code>) and <em>annotated</em> the dimensions of some others. This is convenient and makes the code easier to understand, but we need to remember that in PyMC, dimensions are not inherited like in xarray.</p>
<p><code class="docutils literal notranslate"><span class="pre">atts</span></code> is <code class="docutils literal notranslate"><span class="pre">atts_star</span></code> minus a scalar value and it will be an array with the same shape as <code class="docutils literal notranslate"><span class="pre">atts_star</span></code> even without the <code class="docutils literal notranslate"><span class="pre">dims</span></code> argument. However, we need to <em>annotate</em> the dimension if we want the output to have it.</p>
<p>In PyMC 4.0, the default return type of all sampling functions is <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(type(rugby_idata))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class 'arviz.data.inference_data.InferenceData'&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="nd-example-radon-multilevel-model">
<h2>2nd example: radon multilevel model<a class="headerlink" href="#nd-example-radon-multilevel-model" title="Permalink to this heading">#</a></h2>
<p>We will now use one of the many models in the <a class="reference external" href="https://www.pymc.io/projects/examples/en/latest/case_studies/multilevel_modeling.html">A Primer on Bayesian Methods for Multilevel Modeling</a> notebook to dive deeper into coords and dims functionality. We won’t cover the model itself, it’s already explained in the example notebook, we will explain in detail how are labeled coords and dims being used.</p>
<p>The code used to load and clean the data is hidden, click the button below to see it.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>srrs2 = pd.read_csv(pm.get_data("srrs2.dat"))
srrs2.columns = srrs2.columns.map(str.strip)
srrs_mn = srrs2[srrs2.state == "MN"].copy()

srrs_mn["fips"] = srrs_mn.stfips * 1000 + srrs_mn.cntyfips
cty = pd.read_csv(pm.get_data("cty.dat"))
cty_mn = cty[cty.st == "MN"].copy()
cty_mn["fips"] = 1000 * cty_mn.stfips + cty_mn.ctfips

srrs_mn = srrs_mn.merge(cty_mn[["fips", "Uppm"]], on="fips")
srrs_mn = srrs_mn.drop_duplicates(subset="idnum")
u = np.log(srrs_mn.Uppm).unique()

n = len(srrs_mn)
srrs_mn.county = srrs_mn.county.map(str.strip)
srrs_mn["county_code"], mn_counties = pd.factorize(srrs_mn.county)
srrs_mn["log_radon"] = np.log(srrs_mn.activity + 0.1)
</pre></div>
</div>
</div>
</details>
</div>
<p>The first step is again defining the dimensions and their coordinate values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Level</span></code>: observations can correspond to the basement or the first floor</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">County</span></code>: each county has its own basement, intercept: <code class="docutils literal notranslate"><span class="pre">a</span></code>, and first floor, slope <code class="docutils literal notranslate"><span class="pre">b</span></code>, effects. Details are in the example notebook</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">param</span></code>: one of <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">param2</span></code>: same as param, used for the covariance matrix because a variable can’t have repeated dimensions</p></li>
</ul>
<p>We will also use a dimension called <code class="docutils literal notranslate"><span class="pre">obs_id</span></code> for the <code class="docutils literal notranslate"><span class="pre">n</span></code> observations. In that case however, we don’t care about the coordinate values and we are fine with them being an integer id.</p>
<p>In PyMC 4.0, if you <em>annotate</em> the dimensions of a <code class="docutils literal notranslate"><span class="pre">pm.Data</span></code> object (also of <code class="docutils literal notranslate"><span class="pre">pm.ConstantData</span></code> or <code class="docutils literal notranslate"><span class="pre">pm.MutableData</span></code> which are aliases of <code class="docutils literal notranslate"><span class="pre">pm.Data</span></code>), that dimension will be automatically created as dimension without coordinate values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coords = {
    "level": ["basement", "floor"], 
    "county": mn_counties,
    "param": ["a", "b"],
    "param2": ["a", "b"],
}
</pre></div>
</div>
</div>
</div>
<p>We’ll begin to define the model creating the indexing arrays that will implement the hierarchical model. We are using the <code class="docutils literal notranslate"><span class="pre">pm.Data</span></code> container to tell ArviZ to store the variables in the <code class="docutils literal notranslate"><span class="pre">constant_data</span></code> group. Moreover, <code class="docutils literal notranslate"><span class="pre">pm.Data</span></code> defines a theano shared variable, so its values can be modified in order to call <code class="docutils literal notranslate"><span class="pre">pm.sample_posterior_predictive</span></code> using different data. This is particularly interesting for regressions for example in order to generate predictions for the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with pm.Model(coords=coords) as radon_model:
    floor_idx = pm.ConstantData("floor_idx", srrs_mn.floor, dims="obs_id")
    county_idx = pm.ConstantData("county_idx", srrs_mn.county_code, dims="obs_id")
</pre></div>
</div>
</div>
</div>
<p>We’ll also use a <code class="docutils literal notranslate"><span class="pre">LKJCholeskyCov</span></code>as prior for the covariance matrix. As you can see, it has no <code class="docutils literal notranslate"><span class="pre">dims</span></code> argument. We will have to indicate the dims that correspond to these variables with the <code class="docutils literal notranslate"><span class="pre">idata_kwargs</span></code> argument. <code class="docutils literal notranslate"><span class="pre">idata_kwargs</span></code> is used to indicate <code class="docutils literal notranslate"><span class="pre">pm.sample</span></code> what arguments to pass to <a class="reference external" href="https://www.pymc.io/projects/docs/en/v4.0.0/api/generated/pymc.to_inference_data.html"><code class="docutils literal notranslate"><span class="pre">pm.to_inference_data</span></code></a>, which is called internally to convert the trace to InferenceData.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with radon_model:
    sd_dist = pm.Exponential.dist(0.5)
    a = pm.Normal("a", mu=0.0, sigma=5.0)
    b = pm.Normal("b", mu=0.0, sigma=1.0)
    z = pm.Normal("z", 0.0, 1.0, dims=("param", "county"))
    
    chol, corr, stds = pm.LKJCholeskyCov(
        "chol", n=2, eta=2.0, sd_dist=sd_dist, compute_corr=True
    )
</pre></div>
</div>
</div>
</div>
<p>We now will store two intermediate results as variables. However, one is wrapped inside a <code class="docutils literal notranslate"><span class="pre">pm.Deterministic</span></code> whereas the other is not. Both are equally valid. <code class="docutils literal notranslate"><span class="pre">pm.Deterministic</span></code> tells PyMC to store that variable in the trace. Thus <code class="docutils literal notranslate"><span class="pre">pm.Deterministic</span></code> should only be used when we actively want to store the intermediate result. In our case, we want to store <code class="docutils literal notranslate"><span class="pre">ab_county</span></code> but not <code class="docutils literal notranslate"><span class="pre">theta</span></code>.</p>
<p>As we saw in the previous example, <code class="docutils literal notranslate"><span class="pre">pm.Deterministic</span></code> also has a <code class="docutils literal notranslate"><span class="pre">dims</span></code> argument, but it can only be used to <em>annotate</em> the dimensions of that variable, not to <em>define</em> an array variable from scalar parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with radon_model:
    ab_county = pm.Deterministic("ab_county", at.dot(chol, z).T, dims=("county", "param"))
    theta = a + ab_county[county_idx, 0] + (b + ab_county[county_idx, 1]) * floor_idx

    sigma = pm.Exponential("sigma", 1.0)
    pm.Normal("y", theta, sigma=sigma, observed=srrs_mn.log_radon, dims="obs_id")
</pre></div>
</div>
</div>
</div>
<p>Finally we will call <code class="docutils literal notranslate"><span class="pre">pm.sample</span></code> and define the dimensions of the covariance matrix as <code class="docutils literal notranslate"><span class="pre">idata_kwargs</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with radon_model:
    radon_idata = pm.sample(
        2000, tune=2000, target_accept=0.99, random_seed=75625,
        idata_kwargs={"dims": {"chol_stds": ["param"], "chol_corr": ["param", "param2"]}}
    )
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [a, b, z, chol, sigma]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
<progress class="" max="16000" style="width:300px; height:20px; vertical-align: middle;" value="16000"></progress>
      100.00% [16000/16000 06:21&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 382 seconds.
</pre></div>
</div>
</div>
</div>
</section>
<section id="there-is-life-outside-the-posterior">
<h2>There is life outside the posterior<a class="headerlink" href="#there-is-life-outside-the-posterior" title="Permalink to this heading">#</a></h2>
<p>The posterior is the center of Bayesian analysis but other quantities such as the prior or the posterior predictive are also crucial to an analysis workflow. We’ll use a linear regression to quickly showcase some of the key steps in a Bayesian workflow: prior predictive checks, posterior sampling, posterior predictive checks (using LOO-PIT) and out of sample predictions.</p>
<p>We will start generating some simulated data (code hidden, click to expand) and defining the model. As it’s a simple linear regression we’ll only have scalar parameters, <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">sigma</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>a_true = 2
b_true = -0.4
x = np.linspace(0, 10, 31)
year = np.arange(2022-len(x), 2022)
y = a_true + b_true * x + rng.normal(size=len(x))

fig, ax = plt.subplots()
ax.plot(x, y, "o-")
ax.text(
    0.93, 0.9, r"$y_i = a + bx_i + \mathcal{N}(0,1)$", ha='right', va='top', transform=ax.transAxes, fontsize=18
)

ax.set_xticks(x[::3])
ax.set_xticklabels(year[::3])
ax.set_yticks([])
ax.set_xlabel("Year")
ax.set_ylabel("Quantity of interest");
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/492f768a07bedd19a2757b52870587c94237457b825a757179404c5d98b8a00f.png" src="../../../_images/492f768a07bedd19a2757b52870587c94237457b825a757179404c5d98b8a00f.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with pm.Model() as linreg_model:
    # use x_ to avoid overwriting x previously defined as np.ndarray
    x_ = pm.MutableData("x", x, dims="year", coords={"year": year})
    
    a = pm.Normal("a", 0, 3)
    b = pm.Normal("b", 0, 2)
    sigma = pm.HalfNormal("sigma", 2)
    
    pm.Normal("y", a + b * x_, sigma, observed=y, dims="year")
</pre></div>
</div>
</div>
</div>
<p>We have now written a model in order to study our quantity of interest <code class="docutils literal notranslate"><span class="pre">y</span></code>. We have used everything we have seen so far, the <code class="docutils literal notranslate"><span class="pre">pm.MutableData</span></code> container and the labeled dims and coords.</p>
<p>We will now simulate a workflow starting from prior predictive checks and finishing with predicting the values of our <em>quantity of interest</em> in 2022 and 2023.</p>
<p>Here however, as our goal is to generate out of sample predictions, there is an important difference. Instead of providing the coordinates when initializing the model context, we add them in the call to <code class="docutils literal notranslate"><span class="pre">pm.MutableData</span></code>. By initializing the coordinates with a <code class="docutils literal notranslate"><span class="pre">pm.MutableData</span></code> object we make sure that we can later modify both the length of the <code class="docutils literal notranslate"><span class="pre">year</span></code> dimension and its associated coordinate values.</p>
<p>The dimensions defined from <code class="docutils literal notranslate"><span class="pre">coords</span></code> passed while initializing the model context can’t be modified. Their length is fixed. The coordinate values can be updated, but only for an array of the same length.</p>
<section id="priors">
<h3>Priors<a class="headerlink" href="#priors" title="Permalink to this heading">#</a></h3>
<p>We start by sampling both prior and prior predictive with <code class="docutils literal notranslate"><span class="pre">pm.sample_prior_predictive</span></code>. In PyMC 4.0, this returns an <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> object with multiple groups depending on the data available, if provided, variables will have their corresponding dims and coords.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with linreg_model:
    linreg_idata = pm.sample_prior_predictive(700)

linreg_idata
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>Inference data with groups:
	&gt; prior
	&gt; prior_predictive
	&gt; observed_data
	&gt; constant_data</pre></div></div>
</div>
<p>We can now use <code class="docutils literal notranslate"><span class="pre">plot_ppc</span></code> to perform prior predictive checks for our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>az.plot_ppc(linreg_idata, group="prior");
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/97a9b588fa7da6b17b4767324a7e7d79c390e243ea12a91ee1f222c578b4c660.png" src="../../../_images/97a9b588fa7da6b17b4767324a7e7d79c390e243ea12a91ee1f222c578b4c660.png"/>
</div>
</div>
</section>
<section id="posterior">
<h3>Posterior<a class="headerlink" href="#posterior" title="Permalink to this heading">#</a></h3>
<p>The next step will be computing the posterior. As we have seen, we can use <code class="docutils literal notranslate"><span class="pre">return_inferencedata</span></code> to get an <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> as a result of <code class="docutils literal notranslate"><span class="pre">pm.sample</span></code>. In this case however, we will store it as an auxiliary variable to then use <code class="docutils literal notranslate"><span class="pre">InferenceData.extend</span></code> and add the new groups to the <code class="docutils literal notranslate"><span class="pre">linreg_idata</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with linreg_model:
    idata_aux = pm.sample()
linreg_idata.extend(idata_aux)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Auto-assigning NUTS sampler...
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [a, b, sigma]
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
<progress class="" max="8000" style="width:300px; height:20px; vertical-align: middle;" value="8000"></progress>
      100.00% [8000/8000 00:06&lt;00:00 Sampling 4 chains, 0 divergences]
    </div>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling 4 chains for 1_000 tune and 1_000 draw iterations (4_000 + 4_000 draws total) took 7 seconds.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>linreg_idata
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>Inference data with groups:
	&gt; posterior
	&gt; log_likelihood
	&gt; sample_stats
	&gt; prior
	&gt; prior_predictive
	&gt; observed_data
	&gt; constant_data</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>az.plot_pair(linreg_idata);
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/b3f65cf8dd59dd7905a42f5c30f6d3d312163fa37cd1464a065f62722c5647b2.png" src="../../../_images/b3f65cf8dd59dd7905a42f5c30f6d3d312163fa37cd1464a065f62722c5647b2.png"/>
</div>
</div>
</section>
<section id="posterior-predictive">
<h3>Posterior predictive<a class="headerlink" href="#posterior-predictive" title="Permalink to this heading">#</a></h3>
<p>Our third step will be to evaluate the posterior predictive at the observations so we can perform model checking with functions such as <code class="docutils literal notranslate"><span class="pre">plot_ppc</span></code> or <code class="docutils literal notranslate"><span class="pre">plot_loo_pit</span></code>. <code class="docutils literal notranslate"><span class="pre">sample_posterior_predictive</span></code> already returns an InferenceData, we will use the <code class="docutils literal notranslate"><span class="pre">extend_inferencedata</span></code> argument to indicate PyMC to add the new groups inplace.</p>
<p>This has two main advantages. <code class="docutils literal notranslate"><span class="pre">plot_loo_pit</span></code> requires both the <code class="docutils literal notranslate"><span class="pre">posterior_predictive</span></code> group, generated here and the <code class="docutils literal notranslate"><span class="pre">log_likelihood</span></code> group which was created in <code class="docutils literal notranslate"><span class="pre">pm.sample</span></code>. In addition, keeping all our data in a single <code class="docutils literal notranslate"><span class="pre">InferenceData</span></code> means we can store it as a netCDF and share a single file to allow reproducing the whole exploratory analysis of our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with linreg_model:
    pm.sample_posterior_predictive(linreg_idata, extend_inferencedata=True)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
<progress class="" max="4000" style="width:300px; height:20px; vertical-align: middle;" value="4000"></progress>
      100.00% [4000/4000 00:00&lt;00:00]
    </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>linreg_idata
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>Inference data with groups:
	&gt; posterior
	&gt; posterior_predictive
	&gt; log_likelihood
	&gt; sample_stats
	&gt; prior
	&gt; prior_predictive
	&gt; observed_data
	&gt; constant_data</pre></div></div>
</div>
<p>We will now get to use <code class="docutils literal notranslate"><span class="pre">plot_loo_pit</span></code>, which as expected does not show any issues. To learn how to interpret those plots, you can read the <a class="reference internal" href="../2019/loo-pit-tutorial.html#loo-pit-tutorial"><span class="std std-ref">LOO-PIT tutorial</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>az.plot_loo_pit(linreg_idata, y="y");
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7e524a83d694b552bb733cd6bb1966e2e1dd886ec4f7d4daf8ea70639179b5e3.png" src="../../../_images/7e524a83d694b552bb733cd6bb1966e2e1dd886ec4f7d4daf8ea70639179b5e3.png"/>
</div>
</div>
</section>
<section id="predictions">
<h3>Predictions<a class="headerlink" href="#predictions" title="Permalink to this heading">#</a></h3>
<p>Finally, our last step will be to get some predictions, which in this case is evaluating the posterior predictive at positions different than the observations. In the example below, we are evaluating our predictions at 2022 and 2023. To do so, we are using <code class="docutils literal notranslate"><span class="pre">pm.set_data</span></code> to modify the values of <code class="docutils literal notranslate"><span class="pre">x</span></code> to the ones that correspond to these two future years and to update the coordinate values of the <code class="docutils literal notranslate"><span class="pre">year</span></code> dimension.</p>
<p>Here we will use <code class="docutils literal notranslate"><span class="pre">predictions</span></code> and <code class="docutils literal notranslate"><span class="pre">extend_inferencedata</span></code> keywords. This will store these new samples in the <code class="docutils literal notranslate"><span class="pre">predictions</span></code> group and the modified <code class="docutils literal notranslate"><span class="pre">x</span></code> values in <code class="docutils literal notranslate"><span class="pre">predictions_constant_data</span></code> and add these groups inplace to our InferenceData object</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>with linreg_model:
    pm.set_data({"x": x[-1] + x[1:3]}, coords={"year": [2022, 2023]})
    pm.sample_posterior_predictive(linreg_idata, predictions=True, extend_inferencedata=True)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
<progress class="" max="4000" style="width:300px; height:20px; vertical-align: middle;" value="4000"></progress>
      100.00% [4000/4000 00:00&lt;00:00]
    </div>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>linreg_idata
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>Inference data with groups:
	&gt; posterior
	&gt; posterior_predictive
	&gt; predictions
	&gt; log_likelihood
	&gt; sample_stats
	&gt; prior
	&gt; prior_predictive
	&gt; observed_data
	&gt; constant_data
	&gt; predictions_constant_data</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>az.plot_posterior(linreg_idata, group="predictions");
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4e9e6b589b7493a94288389a003ec94186f05e8e2654f27ebb4e7edb682d1931.png" src="../../../_images/4e9e6b589b7493a94288389a003ec94186f05e8e2654f27ebb4e7edb682d1931.png"/>
</div>
</div>
<p>Package versions used to generate this post:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%load_ext watermark
%watermark -n -u -v -iv -w
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last updated: Mon Jun 06 2022

Python implementation: CPython
Python version       : 3.9.10
IPython version      : 8.3.0

aesara    : 2.6.6
matplotlib: 3.5.1
numpy     : 1.21.5
arviz     : 0.13.0.dev0
pymc      : 4.0.0
xarray    : 2022.3.0
pandas    : 1.4.2

Watermark: 2.3.0
</pre></div>
</div>
</div>
</div>
<hr class="docutils"/>
<p>Comments are not enabled for this post, to inquiry further about the contents of the post, ask on <a class="reference external" href="https://discourse.pymc.io/">PyMC Discourse</a>. Feel free to tag me at <a class="reference external" href="https://discourse.pymc.io/u/oriolabril">@OriolAbril</a></p>
</section>
</section>
</section>
</article>
<footer class="bd-footer-article">
</footer>
</div>
<div class="bd-sidebar-secondary bd-toc">
<div class="toc-item">
<div class="ablog__postcard">
<h5>
<i class="fa-regular fa-calendar-days"></i>
  07 June 2022
  
</h5>
<ul>
<li id="ablog-sidebar-item author ablog__author">
<span>
<i class="fa-solid fa-user-pen"></i>
</span>
<label class="sr-only">Author</label>
<a href="../../author/oriol-abril-pla.html">Oriol Abril Pla</a>
</li>
<li id="ablog-sidebar-item category ablog__category">
<span>
<i class="fa-regular fa-folder-open"></i>
</span>
<label class="sr-only">Category</label>
<a href="../../category/pymc.html">pymc</a>
  
  ,
  
  
  
  
  <a href="../../category/xarray.html">xarray</a>
  
  ,
  
  
  
  
  <a href="../../category/python.html">python</a>
  
  ,
  
  
  
  
  <a href="../../category/arviz.html">arviz</a>
</li>
<li id="ablog-sidebar-item tags ablog__tags">
<span>
<i class="fa-solid fa-tags"></i>
</span>
<label class="sr-only">Tags</label>
<a href="../../tag/arviz-converters.html">arviz converters</a>
<a href="../../tag/data-storage.html">data storage</a>
</li>
</ul>
</div>
</div>
<div class="toc-item">
<div class="tocsection onthispage">
<i class="fa-solid fa-list"></i> On this page
</div>
<nav class="page-toc" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#for-the-svg-version-1-1-width-1-0em-height-1-0em-class-sd-octicon-sd-octicon-heart-fill-sd-text-danger-viewbox-0-0-16-16-aria-hidden-true-path-fill-rule-evenodd-d-m7-655-14-916l8-14-25l-345-666a-752-752-0-01-69-0zm0-0l8-14-25l-345-666-002-001-006-003-018-01a7-643-7-643-0-00-31-17-22-08-22-08-0-003-433-2-414c13-956-10-731-16-8-35-16-5-5-16-2-836-13-914-1-11-75-1-10-203-1-8-847-1-802-8-3-02-7-153-1-802-5-797-1-4-25-1-2-086-1-0-2-836-0-5-5c0-2-85-2-045-5-231-3-885-6-818a22-075-22-075-0-003-744-2-584l-018-01-006-003h-002z-path-svg-of-labeled-arrays">
   For the
   <svg aria-hidden="true" class="sd-octicon sd-octicon-heart-fill sd-text-danger" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em">
<path d="M7.655 14.916L8 14.25l.345.666a.752.752 0 01-.69 0zm0 0L8 14.25l.345.666.002-.001.006-.003.018-.01a7.643 7.643 0 00.31-.17 22.08 22.08 0 003.433-2.414C13.956 10.731 16 8.35 16 5.5 16 2.836 13.914 1 11.75 1 10.203 1 8.847 1.802 8 3.02 7.153 1.802 5.797 1 4.25 1 2.086 1 0 2.836 0 5.5c0 2.85 2.045 5.231 3.885 6.818a22.075 22.075 0 003.744 2.584l.018.01.006.003h.002z" fill-rule="evenodd">
</path>
</svg>
   of labeled arrays
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#st-example-rugby-analytics">
   1st example: rugby analytics
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#nd-example-radon-multilevel-model">
   2nd example: radon multilevel model
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#there-is-life-outside-the-posterior">
   There is life outside the posterior
  </a>
<ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#priors">
     Priors
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#posterior">
     Posterior
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#posterior-predictive">
     Posterior predictive
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#predictions">
     Predictions
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
<div class="toc-item">
<div id="searchbox"></div>
</div>
</div>
</div>
</div>
<footer class="bd-footer-content">
<div class="bd-footer-content__inner"></div>
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>
<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//trafic-oriolabrilpla.cat/matomo/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
<script src="../../../_static/js/intro.js"></script>
<div class="footer-notes">
<ul class="footer-list">
<li>© Oriol Abril Pla |
      <a data-toggle="tooltip" href="https://github.com/OriolAbril" rel="noopener" target="_blank" title="GitHub"><span><i class="fa-brands fa-github"></i></span><label class="sr-only">GitHub</label></a> |
      <a data-toggle="tooltip" href="https://twitter.com/OriolAbril" rel="noopener" target="_blank" title="Twitter"><span><i class="fa-brands fa-twitter"></i></span><label class="sr-only">Twitter</label></a> |
      <a data-toggle="tooltip" href="https://oriolabrilpla.cat/blog/atom.xml" rel="noopener" target="_blank" title="Atom Feed"><span><i class="fa-solid fa-rss"></i></span><label class="sr-only">Atom Feed</label></a>
</li>
<li>Powered by <a href="https://www.sphinx-doc.org">sphinx</a></li>
<li>Design by <a href="pydata-sphinx-theme.readthedocs.io/">pydata-sphinx-theme</a>, <a href="https://html5up.net" rel="nofollow">HTML5 UP</a> &amp;
      <a href="https://github.com/mmistakes/jekyll-theme-basically-basic">Basically Basic</a></li>
</ul>
</div>
</body>
</html>